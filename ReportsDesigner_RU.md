
# Введение

В мире огромных объемов данных как никогда важно сделать информацию доступной и легко интерпретируемой. С помощью InterSystems Reports (Logi Reports) вы можете легко и эффективно представлять сложные данные.
  
# Подготовка

1. Установите InterSystems IRIS.
2. Установите InterSystems Reports.
3. Установите [ZPM](https://community.intersystems.com/post/introducing-intersystems-objectscript-package-manager).
4. Установите модуль ZPM HoleFoolds: `zpm "install samples-bi"`

# Упражнение 1: Создание каталога и источника данных для подключения к InterSystems IRIS 

В этом упражнении вы откроете InterSystems Reports Designer (Logi Report Designer) и создадите каталог HoleFoods с InterSystems IRIS в качестве источника данных. Этот каталог поможет организовать ваши источники данных, запросы, отчеты и другие ресурсы. Каждый каталог может иметь любое количество таких ресурсов, но только один каталог одновременно может активно редактироваться из Designer.

1. Откройте Logi Report Designer. Когда появится начальный экран, нажмите на X, чтобы закрыть его и перейти к основной рабочей области.
2. В Designer нажмите `File` > `New Catalog` и заполните поля следующим образом:
   - Name: `HoleFoods.cat`
   - Data Source Name: `IRIS2020`

После создания каталога автоматически появляется Catalog Manager.

![image](https://user-images.githubusercontent.com/5127457/130675722-1d12b761-4922-442a-8ad8-2f7e6e361766.png)

3. Нажмите правой кнопкой мыши на `IRIS2020`, затем `New JDBC Connection` и выберите `InterSystems IRIS` в качестве `Connection Type`. Заполните следующие поля:
 
   - Server: localhost
   - Port: 1972
   - Namespace: область установки HoleFoods
   - User: пользователь
   - Password: пароль

4. Нажмите `Test Connection`, чтобы убедиться, что вы можете успешно подключиться к вашему серверу InterSystems IRIS, и нажмите `OK`.
5. Во всплывающем окне нажмите `Add Tables` и добавьте таблицы, на которые вы будете ссылаться из этого источника данных.

   - В разделе `Schemas` выберите `HoleFoods`.
   - Нажмите `Refresh`, чтобы перечислить все таблицы в этой схеме. 
   - Выберите все доступные таблицы и нажмите кнопку `Add`. 
   - Нажмите `Done`.
   - Нажмите `X`, чтобы выйти из всплывающего окна `New Queries or Business Views`.

6. Многие поля в наборе данных HoleFoods имеют одинаковые имена, например ID и Name. Чтобы в дальнейшем не пришлось развязывать эти поля, удалите автоматическую привязку полей: 

   - Нажмите `Options` > `Query Editor`.
   - Снимите все опции `Auto Join` и нажмите `OK`.

    ![image](https://user-images.githubusercontent.com/5127457/130676761-768973ec-cf74-4e65-90c6-4924a3bb194d.png)

7. Затем создайте новый запрос с именем `HoleFoodsTransactionsQuery`, который использует источник данных `InterSystems IRIS`, включая все таблицы и поля.
  
   - Нажмите `Queries`, чтобы изменить верхнее ленточное меню в этом окне, затем `New Query`.
![image](https://user-images.githubusercontent.com/5127457/130676961-b9e71b4d-9844-4dc5-9e82-b76469703f74.png)
   - Назовите запрос `HoleFoodsTransactionsQuery`. 
   - Когда появится запрос на выбор таблиц для включения в запрос, разверните подключения JDBC и выберите все таблицы, которые вы добавили в шаге 5. 
   - Нажмите стрелку вправо (![image](https://user-images.githubusercontent.com/5127457/130677115-2cd0fa43-33df-4fa4-b54b-24f067a44957.png)) в Мастере, чтобы добавить таблицы, затем нажмите `OK`.

8. Укажите столбцы для запроса и столбцы для объединения. Таблицы появятся в интерактивном окне в верхней части редактора запросов. Каждый столбец SQL будет перечислен в таблице в виде строки с установленным рядом флажком.

    - Установите флажок звездочки (`*`) в каждой таблице, чтобы выбрать все столбцы для запроса. 
![image](https://user-images.githubusercontent.com/5127457/130677247-802998bb-7122-4d66-8f14-7fe550e576b8.png)
   - Перетащите один столбец SQL на другой, чтобы создать соединения между следующими таблицами:

     + `SalesTransaction.Product` и `Product.Product_ID`.
     + `SalesTransaction.Outlet` и `Outlet.Outlet_ID`.
     + `Country.Region` и `Region.Region_ID`.
     + `Outlet.Country` и `Country.ID`. 
 ![image](https://user-images.githubusercontent.com/5127457/130677479-2558bb06-3dc1-483a-a4fb-68920c3b0023.png)
   - Если вы случайно соединили неправильные столбцы, дважды нажмите по ячейке с буквой `J` в линии, соединяющей таблицы, нажмите `Delete Join` во всплывающем окне и нажмите `OK`.

![image](https://user-images.githubusercontent.com/5127457/130677553-9f63776e-da90-4e49-82e7-e7b3277ce9a3.png)

9. Нажмите `Save Catalog`. 
10. Нажмите `X`, чтобы выйти из менеджера каталогов.

# Упражнение 2: Использование запросов и сводок в ленточном отчете

В этом упражнении вы создадите полосный отчет, отображающий количество проданных единиц для каждого продукта. Затем вы добавите группировки и сводки, чтобы получить агрегированные данные. Наконец, вы добавите логотип к отчету, чтобы придать ему индивидуальность.

Отчет с полосами полезен для отчетов, в которых требуются специальные макеты, группировки, итоги, промежуточные итоги, сводки, диаграммы, графики или встроенные изображения. Полосы повторяются и позволяют упорядочить данные с помощью одинаковых заголовков и другого содержимого.

1. В Designer Нажмите `Home` > `New` > `Page Report`. 
2. В поле `Title`  введите `HoleFoods Transactions by Date`.
3. Выберите `Banded`. 
4. Нажмите `OK`, чтобы войти в мастер создания отчета (Banded Wizard).
5. Выберите запрос `HoleFoodsTransactionsQuery`, затем нажмите кнопку `Next`.
6. Добавьте следующие столбцы для отображения:

    |    Table Name          |    Column Name     |
    |------------------------|--------------------|
    |    SalesTransaction    |    DateOfSale      |
    |    Product             |    Product_Name    |
    |    SalesTransaction    |    UnitsSold       |
    |    SalesTransaction    |    AmountOfSale    |

   - Нажмите `Finish`, затем выберите в меню `File` > `Save`.
   - Назовите отчет `HoleFoodsPageReport.cls`.

![image](https://user-images.githubusercontent.com/5127457/130797847-5cd84a7e-58d7-435b-b6c9-698fa20b1c98.png)

7. В нижней левой части вкладки `Design` нажмите правой кнопкой мыши по имени вкладки отчета, чтобы переименовать её в `HoleFoodsTransactionsFullList`. 
8. Нажмите кнопку `View` (Просмотр), чтобы запустить отчет. Обратите внимание на большое количество страниц в отчете: 

![image](https://user-images.githubusercontent.com/5127457/130798099-fdf82772-78bb-44c5-af2c-8e82f6e97458.png)

В настоящее время отчет выдает все строки, соответствующие поисковому запросу, а не агрегированную сводку, в которой было бы сгруппировано общее количество продаж каждого продукта. Далее вы создадите агрегированную сводку.

9. Создайте отчет, который объединит и обобщит эти результаты: 
   - Вернитесь на вкладку `Design`, нажмите правой кнопкой мыши вкладку отчета `HoleFoodsTransactionsFullList` в нижней части листа отчета и нажмите кнопку `duplicate`. 
10. Измените название нового отчета на `Transactions By Product`, щелкнув правой кнопкой мыши на вкладке `Report Title` внизу и выбрав `Rename`.
11. Создайте сводку по общему объему продаж: 

    - На панели `Data` слева прокрутите страницу в самый низ и нажмите `Summaries` > `New Summary`. 
    - Заполните приведенные ниже поля, используя панель ресурсов и выпадающие меню. Обратите внимание, что поля допускают ручной ввод, но вы должны использовать кнопки со стрелками на странице (![image](https://user-images.githubusercontent.com/5127457/130677115-2cd0fa43-33df-4fa4-b54b-24f067a44957.png)), чтобы эффективно добавлять в них колонки SQL.

      + Aggregate Function: Sum
      + Summary On: SalesTransaction.AmountOfSale
      + Static Summary: selected
      + Group By: Product.Product_Name

![image](https://user-images.githubusercontent.com/5127457/130798636-0eb2612c-f3dc-4f1a-b1ae-13b4d89ef0f0.png)

   - После нажатия кнопки `OK` введите `Total Sales` в качестве имени.

12. Создайте вторую сводку для общего количества единиц товаров: 
    - На панели `Data` слева прокрутите страницу в самый низ и нажмите `Summaries` > `New Summary`. 
    - Заполните приведенные ниже поля, используя панель ресурсов и выпадающие меню.

      + Aggregate Function: Sum
      + Summary On: SalesTransaction.UnitsSold
      + Static Summary: selected
      + Group by: ProductName

![image](https://user-images.githubusercontent.com/5127457/130799066-157a89b8-6934-4bc4-b6fd-d7c905f9f360.png)

   - После нажатия кнопки `OK` введите `Total Units` в качестве имени.
   - Сохраните лист.

13. На вкладке `Design` нажмите в любом месте сетки, чтобы отобразить идентификаторы рядов (BH, BPH и т.д.) слева от каждого ряда.

![image](https://user-images.githubusercontent.com/5127457/130799310-0aa271f3-fb32-4a9a-9dae-2a757e35e764.png)

14. В отчете нажмите правой кнопкой мыши внутри строк `BF` или `BPF` на вкладке `Design` и выберите `Banded Wizard`. `BF` и `BPF` означают соответственно `Banded Footer` и `Banded Page Footer`.
15. Нажмите `Back`, чтобы вернуться на страницу `Display` и удалите `DateOfSale`, щелкнув по нему и используя стрелку влево (![image](https://user-images.githubusercontent.com/5127457/130799585-c3806b42-3239-4e6b-ab3f-1d1915133dea.png)), затем нажмите `Next`.
16. Используя панель ресурсов и экранные кнопки со стрелками, выберите `Product.Product_Name` в качестве объекта группировки (Banded Object). 
17. Нажмите `Next` и выберите стиль `Classic`, затем нажмите `Finish`.
18. В сетке отчета найдите в строке `GH` поле с крестиками, которое представляет только что созданный объект `Product_Name`. Перетащите это поле так, чтобы оно выровнялось со столбцом `Product_Name`.

![image](https://user-images.githubusercontent.com/5127457/130799810-94836252-8485-4db3-ae3f-513824ba9132.png)

19. Переместите столбцы так, чтобы они были выровнены по левому краю.

    - Находясь за пределами таблицы, Нажмите мышью на представление и перетащите его, чтобы создать рамку, охватывающую все три колонки и строки данных под ними.
    - ![image](https://user-images.githubusercontent.com/5127457/130800054-6fe6a11d-0d86-4f98-8baf-00d8d689814b.png)
    - Найдите поле, очерченное сплошной синей линией, и наведите курсор мыши на это поле, чтобы активировать курсор перемещения. В таком положении мышь позволит вам перемещать весь набор полей, выделенных в предыдущем шаге.
    - Перетащите все поля влево, чтобы выровнять их по левой стороне отчета.

![image](https://user-images.githubusercontent.com/5127457/130800202-23003ad2-acc0-45ae-a09b-a1a69a04f9e1.png)

20. Перетащите сводку `Total Sale` в заголовок группы (GH) под столбцом `AmountOfSale`.

    - Это приведет к автоматическому заполнению метки вместе с полем. Удалите эту метку, Total Sales, нажав по ней правой кнопкой мыши и выбрав `Delete`.
    - ![image](https://user-images.githubusercontent.com/5127457/130800440-7531d7bb-7b9a-4af5-85cf-4aceffd5b073.png)
    - Перетащите только что созданное поле данных, представляющее общий объем продаж, чтобы выровнять его со столбцом `AmountOfSale`.

21. Повторите этот шаг для сводки `Total Units`: 

    - Перетащите сводку `Total Units` из панели данных слева и поместите ее в заголовок группы (GH) под `UnitsSold`.
    - Удалите автоматически заполняемую метку `Units Sold`.
    - Перетащите вновь созданное поле данных, чтобы выровнять его со столбцом `UnitsSold`.

![image](https://user-images.githubusercontent.com/5127457/130800646-8bdabac7-e488-48d2-88b5-ce796e16d24e.png)

22. Перейдите на вкладку `View`, чтобы просмотреть отчет.

![image](https://user-images.githubusercontent.com/5127457/130800748-94e94d46-955b-4021-bade-e268dc6fa53e.png)

23. Чтобы агрегировать отчет по продуктам, вернитесь на вкладку `Design`. 

    - Скройте панель деталей, щелкнув правой кнопкой мыши `DT` и выбрав `Hide`, а затем нажмите `Save`. 

![image](https://user-images.githubusercontent.com/5127457/130800926-05b1f446-8ef3-404c-b253-1da3daaebcfc.png)

24. Нажмите кнопку `View` еще раз, чтобы просмотреть агрегированный отчет.

![image](https://user-images.githubusercontent.com/5127457/130801081-7d7ebf71-4265-4f44-9560-77f1db0e0714.png)

# Упражнение 3: Постройте гистограмму для визуализации данных

В этом упражнении вы будете использовать столбчатую диаграмму для отображения проданных товаров по регионам. Каждый регион будет иметь свой столбец, что позволит вам увидеть, в каком регионе было продано больше всего товаров.

Гистограмма позволяет легко просматривать данные по нескольким группам. Наша гистограмма также будет включать динамический фильтр, чтобы конечные пользователи могли изменять просматриваемые данные (в данном случае тип продукта).

1. Создайте сводку "Проданные единицы по регионам": 
   - На панели данных прокрутите вниз и нажмите Сводки > Новая сводка. 
   - Заполните следующие поля с помощью панели ресурсов и выпадающих меню.

     + Aggregate Function: Sum
     + Summary On: SalesTransaction.UnitsSold
     + Static Summary: selected
     + Group by: Region.Region_Name

   - Нажмите OK и введите в качестве названия Units Sold by Region.
   - Нажмите кнопку Сохранить.


2. Создайте новую вкладку диаграммы внутри отчета, нажав Главная > Новая > Вкладка отчета. 
   - Назовите вкладку График проданных единиц по регионам.
   - Выберите диаграмму.
   - Нажмите OK.
3. В мастере создания диаграмм создайте новую гистограмму со стеком:
   - Выберите HoleFoodsTransactionsQuery в качестве запроса и нажмите Next. 
   - В качестве типа диаграммы выберите Bar.
   - Из подвариантов в разделе Тип диаграммы: Bar, выберите Stacked Bar 2-D. Обратите внимание, что названия диаграмм появляются при наведении курсора на изображения. 
   - Нажмите Далее.
   - В окне "Ресурсы" с помощью стрелки вправо добавьте Region_Name в поле x-Axis. 
   - Аналогичным образом добавьте Product.Product_Name в поле Stacking. 
   - Добавьте сводку Units_Sold_by_Region в поле Bar Length. 
   - Нажмите Готово.

![image](https://user-images.githubusercontent.com/5127457/130809458-a7bf5b64-1f98-458e-92b2-d54b0101abf2.png)

